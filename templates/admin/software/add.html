{% extends "base.html" %}

{% block title %}添加软件 - 后台管理系统{% endblock %}

{% block page_title %}添加软件{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- 页面导航 -->
    <div class="row mb-3">
        <div class="col-md-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/admin/dashboard/">仪表板</a></li>
                    <li class="breadcrumb-item"><a href="/admin/dashboard/software/">软件管理</a></li>
                    <li class="breadcrumb-item active" aria-current="page">添加软件</li>
                </ol>
            </nav>
        </div>
    </div>
    
    <!-- 表单卡片 -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">软件信息</h3>
                </div>
                <div class="card-body">
                    <!-- 错误提示 -->
                    {% if error %}
                    <div class="alert alert-danger" role="alert">
                        {{ error }}
                    </div>
                    {% endif %}
                    
                    <!-- 添加软件表单 -->
                    <form method="post" action="/admin/dashboard/software/add/" class="row g-3">
                        <!-- 基本信息 -->
                        <div class="col-md-6">
                            <label for="name" class="form-label">软件名称 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="name" name="name" value="{{ name | default(value="") }}" required placeholder="请输入软件英文名称">
                            <div class="form-text">软件的唯一标识符，用于API调用</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="chinese_name" class="form-label">中文名称 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="chinese_name" name="chinese_name" value="{{ chinese_name | default(value="") }}" required placeholder="请输入软件中文名称">
                            <div class="form-text">软件在界面上显示的中文名称</div>
                        </div>
                        
                        <!-- 描述信息 -->
                        <div class="col-md-12">
                            <label for="description" class="form-label">简要描述 <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="description" name="description" rows="3" required placeholder="请输入软件简要描述">{{ description | default(value="") }}</textarea>
                            <div class="form-text">软件的简短介绍，显示在软件列表中</div>
                        </div>
                        
                        <div class="col-md-12">
                            <label for="detailed_description" class="form-label">详细描述</label>
                            <textarea class="form-control" id="detailed_description" name="detailed_description" rows="5" placeholder="请输入软件详细描述">{{ detailed_description | default(value="") }}</textarea>
                            <div class="form-text">软件的详细介绍，可包含功能说明、使用方法等</div>
                        </div>
                        
                        <!-- 可执行文件信息 -->
                        <div class="col-md-6">
                            <label for="executable_name" class="form-label">可执行文件名称 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="executable_name" name="executable_name" value="{{ executable_name | default(value="") }}" required placeholder="请输入可执行文件名称">
                            <div class="form-text">软件的可执行文件名，如：software.exe</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="md5_checksum" class="form-label">MD5校验和</label>
                            <input type="text" class="form-control" id="md5_checksum" name="md5_checksum" value="{{ md5_checksum | default(value="") }}" placeholder="请输入可执行文件的MD5校验和">
                            <div class="form-text">可执行文件的MD5值，用于完整性验证</div>
                        </div>
                        
                        <!-- 权限设置 -->
                        <div class="col-md-6">
                            <label for="required_vip_level" class="form-label">VIP等级要求 <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="required_vip_level" name="required_vip_level" value="{{ required_vip_level | default(value=0) }}" required min="0" max="10" placeholder="请输入所需VIP等级">
                            <div class="form-text">使用该软件所需的最低VIP等级，0表示无需VIP</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">权限设置</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="requires_admin" name="requires_admin" value="true" {% if requires_admin | default(value=false) %}checked{% endif %}>
                                <label class="form-check-label" for="requires_admin">
                                    需要管理员权限
                                </label>
                            </div>
                            <div class="form-text">勾选表示软件需要以管理员权限运行</div>
                        </div>
                        
                        <!-- 表单操作 -->
                        <div class="col-md-12">
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save"></i> 保存
                                </button>
                                <button type="reset" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> 重置
                                </button>
                                <a href="/admin/dashboard/software/" class="btn btn-outline-secondary">
                                    <i class="bi bi-arrow-left"></i> 返回列表
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 表单验证脚本 -->
    <script>
        // 表单验证
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            form.addEventListener('submit', function(e) {
                // 这里可以添加自定义验证逻辑
                
                // 检查软件名称是否只包含字母、数字和下划线
                const nameInput = document.getElementById('name');
                const nameRegex = /^[a-zA-Z0-9_]+$/;
                if (!nameRegex.test(nameInput.value)) {
                    e.preventDefault();
                    alert('软件名称只能包含字母、数字和下划线');
                    nameInput.focus();
                    return;
                }
                
                // 检查可执行文件名称是否包含扩展名
                const executableNameInput = document.getElementById('executable_name');
                if (!executableNameInput.value.includes('.')) {
                    e.preventDefault();
                    alert('可执行文件名称应包含扩展名，如：software.exe');
                    executableNameInput.focus();
                    return;
                }
            });
        });
    </script>
</div>
{% endblock %}